# =========================================
# Transcode Flow - Environment Variables
# =========================================
#
# PORT MAPPING STRATEGY:
# ----------------------
# Internal Ports: Used for container-to-container communication (e.g., API -> Database)
# External Ports: Used for host machine access (e.g., localhost:15432)
#
# External Port Formula: Internal Port + 10000
# Example: PostgreSQL internal 5432 â†’ external 15432
#
# Quick Reference:
# - API (NGINX):     http://localhost:10080
# - Airflow:         http://localhost:18080
# - Grafana:         http://localhost:13000
# - MinIO Console:   http://localhost:19001
# - Prometheus:      http://localhost:19090
# - Flower:          http://localhost:15555
#
# See PORTS.md for complete port mapping reference
# =========================================

# General
PROJECT_NAME=transcode-flow
ENVIRONMENT=development

# =========================================
# PostgreSQL Database
# =========================================
POSTGRES_HOST=postgres
POSTGRES_PORT=5432  # Internal port (containers communicate)
POSTGRES_EXTERNAL_PORT=15432  # External port (host access)
POSTGRES_USER=transcode_user
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_123
POSTGRES_DB=transcode_db

# Database URL (auto-generated from above)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# =========================================
# Redis (Celery Broker)
# =========================================
REDIS_HOST=redis
REDIS_PORT=6379  # Internal port (containers communicate)
REDIS_EXTERNAL_PORT=16379  # External port (host access)
REDIS_DB=0
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}

# =========================================
# MinIO (S3-Compatible Storage)
# =========================================
MINIO_HOST=minio
MINIO_PORT=9000  # Internal API port (containers communicate)
MINIO_EXTERNAL_PORT=19000  # External API port (host access)
MINIO_CONSOLE_PORT=9001  # Internal console port
MINIO_CONSOLE_EXTERNAL_PORT=19001  # External console port (host access)
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=CHANGE_ME_MINIO_PASSWORD_123
MINIO_ACCESS_KEY=${MINIO_ROOT_USER}
MINIO_SECRET_KEY=${MINIO_ROOT_PASSWORD}
MINIO_BUCKET_NAME=videos
MINIO_SECURE=false

# =========================================
# Airflow
# =========================================
AIRFLOW_UID=50000
AIRFLOW_GID=0
AIRFLOW_ADMIN_USER=admin
AIRFLOW_ADMIN_PASSWORD=CHANGE_ME_AIRFLOW_ADMIN_PASSWORD
AIRFLOW_WEBSERVER_PORT=8080  # Internal port (containers communicate)
AIRFLOW_WEBSERVER_EXTERNAL_PORT=18080  # External port (host access)
AIRFLOW__CORE__EXECUTOR=CeleryExecutor
AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql+psycopg2://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}
AIRFLOW__CELERY__BROKER_URL=${REDIS_URL}
AIRFLOW__CELERY__RESULT_BACKEND=db+postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}
AIRFLOW__CORE__FERNET_KEY=CHANGE_ME_GENERATE_WITH_python_cryptography_fernet_Fernet_generate_key
AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION=true
AIRFLOW__CORE__LOAD_EXAMPLES=false
AIRFLOW__API__AUTH_BACKEND=airflow.api.auth.backend.basic_auth
AIRFLOW__WEBSERVER__SECRET_KEY=CHANGE_ME_AIRFLOW_SECRET_KEY_123

# =========================================
# Celery Workers
# =========================================
CELERY_BROKER_URL=${REDIS_URL}
CELERY_RESULT_BACKEND=db+postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}
CELERY_WORKER_CONCURRENCY=8

# =========================================
# FastAPI
# =========================================
API_HOST=0.0.0.0
API_PORT=8000  # Internal port (containers communicate)
API_EXTERNAL_PORT=18000  # External port (host access - direct)
API_NGINX_PORT=10080  # External port (host access - via NGINX)
API_RELOAD=true
API_WORKERS=4
SECRET_KEY=CHANGE_ME_FASTAPI_SECRET_KEY_GENERATE_WITH_openssl_rand_hex_32
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# =========================================
# Streaming
# =========================================
STREAMING_SECRET_KEY=CHANGE_ME_STREAMING_SECRET_KEY_123

# =========================================
# Grafana
# =========================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD_123
GRAFANA_PORT=3000  # Internal port (containers communicate)
GRAFANA_EXTERNAL_PORT=13000  # External port (host access)

# =========================================
# Prometheus
# =========================================
PROMETHEUS_PORT=9090  # Internal port (containers communicate)
PROMETHEUS_EXTERNAL_PORT=19090  # External port (host access)

# =========================================
# NGINX
# =========================================
NGINX_HTTP_PORT=80  # Internal port (containers communicate)
NGINX_HTTP_EXTERNAL_PORT=10080  # External HTTP port (host access)
NGINX_HTTPS_PORT=443  # Internal port (containers communicate)
NGINX_HTTPS_EXTERNAL_PORT=10443  # External HTTPS port (host access)

# =========================================
# Monitoring & Alerts
# =========================================
ALERTMANAGER_PORT=9093  # Internal port (containers communicate)
ALERTMANAGER_EXTERNAL_PORT=19093  # External port (host access)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=alerts@example.com
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD
ALERT_EMAIL=team@example.com
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# =========================================
# Secrets Management (Production)
# =========================================
# Options: env (development), vault (production), aws (AWS deployments)
SECRETS_PROVIDER=env
VAULT_ADDR=http://vault:8200
VAULT_TOKEN=CHANGE_ME_VAULT_TOKEN

# =========================================
# Logging
# =========================================
LOG_LEVEL=INFO
LOG_FORMAT=json

# =========================================
# Performance & Limits
# =========================================
MAX_UPLOAD_SIZE_BYTES=10737418240  # 10GB
MAX_CONCURRENT_JOBS=8
DEFAULT_JOB_PRIORITY=5
JOB_TIMEOUT_SECONDS=14400  # 4 hours

# =========================================
# FFmpeg Settings
# =========================================
FFMPEG_THREADS=0  # 0 = auto (use all available)
FFMPEG_PRESET=medium  # ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow

# =========================================
# Whisper Settings
# =========================================
WHISPER_MODEL_AUTO=true  # Auto-select model based on duration
WHISPER_DEFAULT_MODEL=base  # tiny, base, small, medium, large

# =========================================
# Rate Limiting
# =========================================
RATE_LIMIT_PER_MINUTE=100
RATE_LIMIT_PER_HOUR=1000
RATE_LIMIT_PER_DAY=10000

# =========================================
# Development Tools
# =========================================
FLOWER_PORT=5555  # Internal port (containers communicate)
FLOWER_EXTERNAL_PORT=15555  # External port (host access)
FLOWER_BASIC_AUTH=admin:CHANGE_ME_FLOWER_PASSWORD

# =========================================
# Data Paths (inside containers)
# =========================================
DATA_DIR=/data
TEMP_DIR=/data/temp
BACKUP_DIR=/data/backups
LOG_DIR=/data/logs
